# 1.1 IoC 컨테이너: 빈 팩토리와 애플리케이션 컨텍스트

- 스프링 애플리케이션에서는 오브젝트의 생성과 관계설정, 사용, 제거 등의 작업을 독립된 컨테이너가 담당한다.
    - 이를 IoC라고 부르며 그래서 스프링 컨테이너를 IoC 컨테이너 라고도 한다.

- 빈 팩토리: 오브젝트의 생성과 오브젝트 사이의 런타임 관계를 설정하는 DI 관점으로 볼때
- 애플리케이션 컨텍스트: 빈 팩토리에 엔터프라이즈 애플리케이션을 개발하는데 필요한 컨테이너 기능을 추가한 것
⇒ 애플리케이션 컨텍스트는 빈 팩토리이면서 그 이상의 기능을 가졌다.

- 스프링 IoC 컨테이너는 일반적으로 애플리케이션 컨텍스트를 말하는데 애플리케이션 컨텍스트는 DI를 관리하는 빈 팩토리의 영역을 포함한 컨테이너 기능을 가지고 있다.

## .1.1 IoC 컨테이너를 이용해 애플리케이션 만들기

### POJO 클래스

애플리케이션의 동작을 담을 클래스를 생성한다.

각자 기능에 충실하게 독립적으로 설계되어야하며 낮은 결합도를 위해 인터페이스를 이용해 연결해준다.

> POJO란 Plain Old Java Object 의 약자로 다른 클래스나 인터페이스의 상속/implements를 받아 메서드가 추가된 클래스가 아닌 getter/setter 같이 기본적인 기능만 가진 자바 객체를 의미한다.


### 설정 메타정보

- 스프링 컨테이너가 관리하는 오브젝트를 빈이라고하는데 설정 메타정보는 이 빈을 어떻게 만들고 어떻게 동작할지에 관한 정보이다.

- 애플리케이션 컨텍스트는 BeanDefinition 인터페이스로 표현된 메타정보를 사용해 IoC와 DI 작업을 수행한다.

- 스프링 IoC 컨테이너는 각 빈에 대한 설정 메타정보를 읽고, 참고해 DI 작업을 수행한다.

- 작업을 통해 만들어지고, DI로 연결되는 오브젝트가 모여서 하나의 애플리케이션을 구성하고 동작한다.

✅ IoC 컨테이너의 역할은 POJO 클래스와 설정 메타정보가 결합되어 하나의 애플리케이션으로 만들어준다.

## 1.1.2 IoC 컨테이너의 종류와 사용 방법

### StaticApplicationContext

- 코드를 통해 빈 메타정보를 등록하기 위해 사용
- 실전에서는 사용하지 않는다.

### GenericApplicationContext

- 가장 일반적인 애플리케이션 컨텍스트의 구현 클래스
- 컨테이너의 주요 기능을 DI를 통해 확장할 수 있게 설계되어있다.
- StaticApplicationContext와는 다르게 외부 리소스에 있는 빈 설정 메타정보를 리더를 통해 읽어 메타정보로 전환해 사용한다.
- 스프링을 사용하는 독립형 애플리케이션을 만들지 않는 한 직접 이용하는 경우가 없지만 JUnit 테스트때 사용할 수 있게 자동으로 만들어진다.

### GenericXmlApplicationContext

- GennericApplicationContext에 XmlBeanDefinitionReader 가 결합된 컨텍스트

### WebApplicationContext

- 가장 많이 사용되는 애플리케이션 컨텍스트
- 웹 모듈에 대한 정보에 접근할 수 있어 웹 환경으로 부터 데이터를 가져오거나 웹 환경에 스프링 컨테이너 자신을 노출해 같은 웹 모듈에 들어있는 일반 오브젝트와 연동될 수 있다.
- 서블릿을 만들고 미리 애플리케이션 컨텍스트를 생성한 다음 서블릿으로 요청이 들어올대마다 getBean()으로 필요한 빈을 가져와 메서드를 실행한다.
    - DispatcherServlet 을 이용하면 클라이언트로 부터 들어오는 요청마다 적절한 빈을 찾아서 실행해준다.

## 1.1.3 IoC 컨테이너 계층구조

### 부모 컨텍스트를 이용한 계층구조 효과

자식 애플리케이션 컨텍스트를 만들어 트리구조의 컨텍스트 계층을 만들 수 있다.

- 계층 구조 안 컨텍스트는 각자 독립적으로 자신이 관리하는 빈을 가지고 있지만 DI를 위해 빈을 찾을대는 부모 컨텍스트까지 검색한다.
- 부모 컨텍스트는 자식 컨텍스트에서 빈을 찾지 못한다.
- 사용 이유
    - 미리 만들어진 애플리케이션 컨텍스트의 설정을 그대로 사용하면서 일부 빈의 설정을 변경하고 싶을때 계층구조를 사용한다.
    - 핵심 로직을 담은 코드를 공유하고 싶을 때 계층 구조를 사용한다.

## 1.1.4 웹 애플리케이션의 IoC 컨테이너 구성

웹 애플리케이션 안에 WebApplicationContext 타입의 IoC 컨테이너를 두는 방법

- 스프링 애플리케이션의 요청을 처리하는 서블릿 안에서 만들어지는 방법
- 웹 애플리케이션 레벨에서 만들어지는 방법

프론트 컨트롤러 패턴: 몇개의 서블릿이 중앙집중식으로 모든 요청을 다 받아서 처리하는 방식

### 웹 애플리케이션 컨텍스트 계층구조

- 웹 애플리케이션에는 하나 이상의 서블릿이 등록될 수 있고, 서블릿은 독립적으로 애플리케이션 컨텍스트를 만든다. 이때 공통적인 빈들을 웹 애플리케이션 레벨의 컨텍스트에 등록하면 공통되는 빈이 서블릿별로 중복되는 경우를 방지할 수 있다.


- 실제로는 두개의 서블릿을 만들기 보다 하나의 서블릿과 루트 애플리케이션 컨텍스트로만 구성해서 웹 기술에 의존적인 부분과 의존적이지 않는 부분으로 구분하는 경우가 많다.


### 웹 애플리케이션의 컨텍스트 구성방법

- 서블릿 컨텍스트와 루트 애플리케이션 컨텍스트 계층 구조
    - 가장 많이 사용되는 기본적인 구성방법
    - 스프링 웹 관련 빈들은 서블릿의 컨텍스트에 두고 나머지는 루트 애플리케이션 컨텍스트에 등록한다.
- 루트 애플리케이션 컨텍스트 단일구조
    - 스프링 웹 기술 사용 없이 서드파티 웹 프레임워크나 서비스 엔진만을 사용하는 경우에 사용한다.
- 서블릿 컨텍스트 단일구조
    - 루트 애플리케이션 컨텍스트를 생략한 구조
    - 서블릿에서 만들어지는 컨텍스트에 모든 빈을 등록해 사용한다.

### 루트 애플리케이션 컨텍스트 등록

- 서블릿의 이벤트 리스너를 이용하면 루트 웹 애플리케이션 컨텍스트를 간단하게 등록할 수 있다.
- 스프링에서는 웹 애플리케이션이 시작될 때 루트 애플리케이션 컨텍스트를 만들어 초기화하고, 종료될 때 컨텍스트를 종료하는 기능을 가진 ContextLoaderListener를 제공한다.

### 서블릿 애플리케이션 컨텍스트 등록

- 스프링의 웹 기능을 지원하는 프론트 컨트롤러 서블릿은 DispatcherServlet이다.
- 서블릿의 이름을 다르게 지정함녀 하나의 웹 애플리케이션에 여러개의 서블릿을 등록할 수 있으며 각 서블릿은 초기화 될때 자신만의 컨텍스트를 생성하고 초기화한다. 동시에 루트 애플리케이션 컨텍스트를 찾아 자신의 부모 컨텍스트로 사용한다.